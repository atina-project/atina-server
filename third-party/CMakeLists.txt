if(CMAKE_VERSION VERSION_GREATER_EQUAL "3.24.0")
    cmake_policy(SET CMP0077 "NEW")
endif()

set(HTTPLIB_COMPILE ON)
set(HTTPLIB_INSTALL OFF)
set(HTTPLIB_INSTALL_LIB_ONLY ON)
set(HTTPLIB_INSTALL_LIB_PATH ${ATINA_SERVER_INSTALL_LIB_DIR})
set(HTTPLIB_LIB_NO_SOVERSION ON)
set(HTTPLIB_REQUIRE_OPENSSL ON)
add_subdirectory(cpp-httplib)
set(HTTPLIB_INCLUDE_DIR "${HTTPLIB_SPLITED_INCLUDE_DIR}" CACHE INTERNAL "${HTTPLIB_SPLITED_INCLUDE_DIR}")

set(ADD_FATAL_EXAMPLE OFF)
set(ADD_G3LOG_PERFORMANCE OFF)
set(ADD_G3LOG_UNIT_TEST OFF)
set(G3LOG_LIB_INSTALL_PATH ${ATINA_SERVER_INSTALL_LIB_DIR})
set(G3LOG_LIB_NO_SOVERSION ON)
set(INSTALL_G3LOG OFF)
set(INSTALL_G3LOG_LIB_ONLY ON)
set(USE_DYNAMIC_LOGGING_LEVELS ON)
add_subdirectory(g3log)
set(G3LOG_INCLUDE_DIR
    "${CMAKE_CURRENT_SOURCE_DIR}/g3log/src"
    "${CMAKE_CURRENT_BINARY_DIR}/g3log/include"
    CACHE INTERNAL
    "${CMAKE_CURRENT_SOURCE_DIR}/g3log/src"
    "${CMAKE_CURRENT_BINARY_DIR}/g3log/include"
)

set(HYPODERMIC_COPY_HEADER_TO_BINARY_DIR ON)
set(HYPODERMIC_NO_INSTALL ON)
set(HYPODERMIC_NO_TEST ON)
add_subdirectory(Hypodermic)
set(HYPODERMIC_INCLUDE_DIR "${CMAKE_CURRENT_BINARY_DIR}/Hypodermic/Hypodermic/include" CACHE INTERNAL "${CMAKE_CURRENT_BINARY_DIR}/Hypodermic/Hypodermic/include")

set(JSONCPP_WITH_TESTS OFF)
set(JSONCPP_WITH_PKGCONFIG_SUPPORT OFF)
set(JSONCPP_WITH_CMAKE_PACKAGE OFF)
set(BUILD_STATIC_LIBS OFF)
set(BUILD_OBJECT_LIBS OFF)
set(JSONCPP_INSTALL_LIB_ONLY ON)
set(JSONCPP_INSTALL_LIB_PATH ${ATINA_SERVER_INSTALL_LIB_DIR})
set(JSONCPP_LIB_NO_SOVERSION ON)
add_subdirectory(jsoncpp)
set(JSONCPP_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/jsoncpp/include" CACHE INTERNAL "${CMAKE_CURRENT_SOURCE_DIR}/jsoncpp/include")

set(WCDB_INCLUDE_DIR "${CMAKE_CURRENT_BINARY_DIR}/wcdb/src/export_headers" CACHE INTERNAL "${CMAKE_CURRENT_BINARY_DIR}/wcdb/src/export_headers")
add_subdirectory(wcdb/src)
install(TARGETS WCDB
    RUNTIME DESTINATION ${ATINA_SERVER_INSTALL_LIB_DIR}
    LIBRARY DESTINATION ${ATINA_SERVER_INSTALL_LIB_DIR}
)
